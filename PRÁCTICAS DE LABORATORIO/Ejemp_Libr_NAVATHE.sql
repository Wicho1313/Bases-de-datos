CLEAR SCREEN
REM 27 de febrero del 2018
REM EMPLO LIBRO NAVATHE
REM

CLEAR SCREEN
REM ELIMINAR TODO EL EJERCICIO
drop table EMPLOYEE;
drop table PROJECT;
drop table works_on;
SET ECHO OFF;
DROP VIEW VISTA_E9;
DROP VIEW VISTA_E8;
DROP VIEW VISTA_E7;
DROP VIEW VISTA_E6;
DROP VIEW VISTA_E5;
DROP VIEW VISTA_E4;
DROP VIEW VISTA_E3;
DROP VIEW VISTA_E2;
DROP VIEW VISTA_E1;

REM INICIO
--
REM TABLA EMPLOYEE
REM
drop table EMPLOYEE;
CREATE TABLE EMPLOYEE(
	FNAME VARCHAR2(15),
		MINIT VARCHAR2(2),
		LNAME VARCHAR2(15),
	SSN NUMBER,
		BDATE DATE,
		ADDRESS VARCHAR2(25),
		SEX VARCHAR2(15),
		SALARY NUMBER,
		SUPERSSN NUMBER,
		DNO NUMBER);
--		
REM TABLA PROJECT		
REM
drop table PROJECT;
CREATE TABLE PROJECT(
	PNAME VARCHAR2(15),
	PNUMBER NUMBER,
		PLOCATION VARCHAR2(15),
		DNUM NUMBER);
--
REM TABLA WORKS_ON		
REM
drop table works_on;
CREATE TABLE works_on(
	ESSN NUMBER,
		PNO NUMBER,
		HOURS NUMBER);
--
REM POBLAR LA TABLA EMPLOYEE
--
--
INSERT INTO EMPLOYEE VALUES
('John','B','Smith',123456789,TO_DATE('1965-01-09','YYYY-MM-DD'),'731 Fondren, Houston, TX','M',30000,333445555,5);
INSERT INTO EMPLOYEE VALUES
('Franklin','T','Wong',333445555,TO_DATE('1955-12-08','YYYY-MM-DD'),'638 Voss, Houston, TX','M',40000,888665555,4);
INSERT INTO EMPLOYEE VALUES
('Jennifer','J','Zelaya',999887777,TO_DATE('1968-01-19','YYYY-MM-DD'),'3321 Castle, Spring, TX','F',25000,9876543221,4);
INSERT INTO EMPLOYEE VALUES
('Alicia','S','Wallane',987654321,TO_DATE('1941-06-19','YYYY-MM-DD'),'291 Berry, Bellaire, TX','F',43000,888665555,4);
INSERT INTO EMPLOYEE VALUES
('Ramesh','K','Narayan',666884444,TO_DATE('1962-09-15','YYYY-MM-DD'),'975 Fire Oak, Humble, TX','M',38000,333445555,5);
INSERT INTO EMPLOYEE VALUES
('Joyce','A','English',453453453,TO_DATE('1972-07-31','YYYY-MM-DD'),'5631 Rice, Houston, TX','F',25000,333445555,5);
INSERT INTO EMPLOYEE VALUES
('Ahmad','V','Jabbar',987987987,TO_DATE('1969-03-29','YYYY-MM-DD'),'980 Dallas, Houston, TX','F',25000,987654321,4);
INSERT INTO EMPLOYEE VALUES
('James','E','Borg',888665555,TO_DATE('1937-11-10','YYYY-MM-DD'),'450 Stone, Houston, TX','M','55000',NULL,1);
--
REM
REM POBLAR LA TABLA WORKS_ON
--
--
insert into works_on values(123456789,1,32.5);
insert into works_on values(123456789,2,7.5);
insert into works_on values(666884444,3,40);
insert into works_on values(453453453,1,20.0);
insert into works_on values(453453453,2,20.0);
insert into works_on values(333445555,2,10.0);
insert into works_on values(333445555,3,10.0);
insert into works_on values(333445555,10,10.0);
insert into works_on values(333445555,20,10.0);
insert into works_on values(999887777,30,30.0);
insert into works_on values(999887777,10,30.0);
insert into works_on values(987987987,10,35.0);
insert into works_on values(987987987,30,5.0);
insert into works_on values(987654321,30,20.0);
insert into works_on values(987654321,20,15.0);
insert into works_on values(888665555,20,NULL);
--
REM POBLAR LA TABLA PROJECT
--
--
insert into project values('ProductX',1,'Bellaire',5);
insert into project values('ProductY',2,'Sugarland',5);
insert into project values('ProductZ',3,'Houston',5);
insert into project values('Computerization',10,'Stafford',5);
insert into project values('Reorganization',20,'Houston',5);
insert into project values('Newbenefits',1,'Stafford',5);

REM FORMATO PARA WORKS_ON
COLUMN ESSN FORMAT 999,999,999;
COLUMN PNO FORMAT 99;
COLUMN HOURS FORMAT 99.9;
COLUMN PNAME FORMAT A11;
COLUMN PNUMBER FORMAT 99;
COLUMN PLOCATION FORMAT A11;
COLUMN DNUM FORMAT 99;

SELECT * FROM EMPLOYEE;
SELECT * FROM WORKS_ON;
SELECT * FROM PROJECT;

SELECT COUNT(*) FROM EMPLOYEE;
SELECT COUNT(*) FROM WORKS_ON;
SELECT COUNT(*) FROM PROJECT;

SELECT * FROM PROJECT,WORKS_ON
WHERE PNO=PNUMBER AND PNAME='ProductX';

SELECT COUNT(*) FROM EMPLOYEE;
SELECT COUNT(*) FROM WORKS_ON;
SELECT COUNT(*) FROM PROJECT;

SELECT COUNT(*) FROM EMPLOYEE, WORKS_ON;

SELECT COUNT(*) FROM PROJECT, WORKS_ON;

DESC ALL_OBJECTS;

REM ELIMINAR VISTAS DEL ARBOL E1
SET ECHO OFF;
DROP VIEW VISTA_E9;
DROP VIEW VISTA_E8;
DROP VIEW VISTA_E7;
DROP VIEW VISTA_E6;
DROP VIEW VISTA_E5;
DROP VIEW VISTA_E4;
DROP VIEW VISTA_E3;
DROP VIEW VISTA_E2;
DROP VIEW VISTA_E1;

REM VISTA DEL ARBOL E

REM VISTA_E1
--
DROP VIEW VISTA_E1;
CREATE VIEW VISTA_E1 AS
SELECT * FROM PROJECT
WHERE Pname = 'ProductX';

REM VISTA_E2
--
DROP VIEW VISTA_E2;
CREATE VIEW VISTA_E2 AS
SELECT PNUMBER FROM VISTA_E1;

REM VISTA_E3
--
DROP VIEW VISTA_E3;
CREATE VIEW VISTA_E3 AS
SELECT ESSN, PNO
FROM WORKS_ON;

REM VISTA_E4
--
DROP VIEW VISTA_E4;
CREATE VIEW VISTA_E4 AS
SELECT * FROM VISTA_E2, VISTA_E3
WHERE PNUMBER = PNO;

REM VISTA_E5
--
DROP VIEW VISTA_E5;
CREATE VIEW VISTA_E5 AS
SELECT ESSN FROM VISTA_E4;

REM VISTA_E6
--
DROP VIEW VISTA_E6;
CREATE VIEW VISTA_E6 AS
SELECT * FROM EMPLOYEE
WHERE BDATE > TO_DATE('1957-12-31','YYYY-MM-DD');

REM VISTA_E7
--
DROP VIEW VISTA_E7;
CREATE VIEW VISTA_E7 AS
SELECT SSN,LNAME 
FROM VISTA_E6;

REM VISTA_E8
--
DROP VIEW VISTA_E8;
CREATE VIEW VISTA_E8 AS
SELECT * FROM VISTA_E5, VISTA_E7
WHERE ESSN = SSN;

REM VISTA_E9
--
DROP VIEW VISTA_E9;
CREATE VIEW VISTA_E9 AS
SELECT LNAME
FROM VISTA_E8;

SELECT LNAME 
FROM EMPLOYEE, WORKS_ON, PROJECT
WHERE PNAME = 'ProductX' AND
	ESSN = SSN AND
	BDATE > TO_DATE('1957-12-31','YYYY-MM-DD') AND
	PNUMBER = PNO;

SELECT * FROM VISTA_E1;
PAUSE
SELECT * FROM VISTA_E2;
PAUSE
SELECT * FROM VISTA_E3;
SELECT * FROM VISTA_E4;
SELECT * FROM VISTA_E5;
SELECT * FROM VISTA_E6;
SELECT * FROM VISTA_E7;
SELECT * FROM VISTA_E8;
SELECT * FROM VISTA_E9;

PROMPT 'CIFRAS CONTROL'
SELECT COUNT(*)"VISTA_E1" FROM VISTA_E1;
SELECT COUNT(*)"VISTA_E2" FROM VISTA_E2;
SELECT COUNT(*)"VISTA_E3" FROM VISTA_E3;
SELECT COUNT(*)"VISTA_E4" FROM VISTA_E4;
SELECT COUNT(*)"VISTA_E5" FROM VISTA_E5;
SELECT COUNT(*)"VISTA_E6" FROM VISTA_E6;
SELECT COUNT(*)"VISTA_E7" FROM VISTA_E7;
SELECT COUNT(*)"VISTA_E8" FROM VISTA_E8;
SELECT COUNT(*)"VISTA_E9" FROM VISTA_E9;

REM FINAL